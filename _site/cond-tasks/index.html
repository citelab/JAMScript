<!DOCTYPE html>
<html lang="en">
  <!-- Beautiful Jekyll | MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Conditional Tasks</title>

  <meta name="author" content="Robert Wenger" />
  
  
  <meta name="description" content="Conditional Execution of Remote Tasks">
  

  <link rel="alternate" type="application/rss+xml" title="JAMScript - A Language and Middleware for Cloud of Moving Things" href="/JAMScript-beta/feed.xml" />

  
    
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css" />
    
      
  
  
    
      <link rel="stylesheet" href="/JAMScript-beta/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/JAMScript-beta/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/JAMScript-beta/css/main.css" />
    
    
  
  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

    
  
  

  

  <!-- Facebook OpenGraph tags -->
  <meta property="og:title" content="Conditional Tasks" />
  <meta property="og:type" content="website" />
  
  <meta property="og:url" content="http://anrl.github.io/JAMScript-beta/cond-tasks/" />
  
  
  <meta property="og:image" content="" />
  
  
  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <meta name="twitter:creator" content="@" />
  <meta name="twitter:title" content="Conditional Tasks" />
  <meta name="twitter:description" content="What are Conditional Tasks? In JAMScript, controllers broadcast remote task execution requests to the sub-controllers or workers. Similarly, workers send remote task execution requests to the controllers at the different levels. The conditional execution is a mechanism to control the remote task executions in a context-sensitive way. The execution context..." />
  
  
</head>


  <body>
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://anrl.github.io/JAMScript-beta">JAMScript</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            
            





<a href="/JAMScript-beta/qstart">Quick Start</a>

          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Install</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="/JAMScript-beta/get-src">Get Source</a>

                
              
                
                  
            





<a href="/JAMScript-beta/linux">Linux</a>

                
              
                
                  
            





<a href="/JAMScript-beta/mac">Mac</a>

                
              
                
                  
            





<a href="/JAMScript-beta/docker">Docker</a>

                
              
                
                  
            





<a href="/JAMScript-beta/iot">Embedded Computers</a>

                
              
            </div>
          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Run</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="/JAMScript-beta/native-run">In Workstation</a>

                
              
                
                  
            





<a href="/JAMScript-beta/emulator-run">In Emulator</a>

                
              
            </div>
          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Language</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="/JAMScript-beta/jam-overview">Overview</a>

                
              
                
                  
            





<a href="/JAMScript-beta/jam-tasks">Remote/Local Tasks</a>

                
              
                
                  
            





<a href="/JAMScript-beta/data-per">Data Persistence</a>

                
              
                
                  
            





<a href="/JAMScript-beta/flow">Flow Computing</a>

                
              
                
                  
            





<a href="/JAMScript-beta/cond-tasks">Conditional Tasks</a>

                
              
            </div>
          </li>
        
        
        
          <li class="navlinks-container">
            <a class="navlinks-parent" href="javascript:void(0)">Examples</a>
            <div class="navlinks-children">
              
                
                  
            





<a href="/JAMScript-beta/jamshell">JAMShell</a>

                
              
                
                  
            





<a href="/JAMScript-beta/parking-spot">Parking Spot App</a>

                
              
            </div>
          </li>
        
        
      </ul>
    </div>

	

  </div>
</nav>


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-heading">
          <h1>Conditional Tasks</h1>
		  
		    
            <hr class="small">
            <span class="page-subheading">Conditional Execution of Remote Tasks</span>
			
		  
		  
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>




<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <h2 id="what-are-conditional-tasks">What are Conditional Tasks?</h2>

<p>In JAMScript, controllers broadcast remote task execution requests to the
sub-controllers or workers. Similarly, workers  send remote task execution
requests to the controllers at the different levels.  The conditional execution
is a mechanism to control the remote task executions in a context-sensitive way.
The execution context could be defined based on node type (e.g., device, fog, or
cloud) or values of the <em>exo-state variables</em> (e.g., loggers and broadcasters).</p>

<p>For instance, using such a conditional remote execution mechanism a worker can
precisely place its remote execution at a particular level. That is, to benefit
from local contexts, it could ask the execution to remain at the fog level
instead of reaching the  cloud level. Conversely, a worker could request certain
other tasks be executed at the  global context (i.e., at the cloud level).</p>

<p>As another example consider a cloud controller requesting certain devices to run a
given task. The eligibility to execute the task is decided based on data values generated
by the devices. We can setup a conditional to test for the eligibility based on the data
values.</p>

<p>can precisely place its
remote task executions between the different available levels: device, fog, or cloud.</p>

<p>request certain calls for remote task
executions must be run at the cloud instead of the fogs. ensure that its
call to the controller is executed at the cloud-level instea</p>

<h2 id="how-to-specify-a-condition">How to specify a Condition?</h2>

<p>Conditions should always be defined in a <strong>jcond{…}</strong> section on a J-node. Each jcond defination statement can hold multiple JConditionals.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jcond <span class="o">{</span>
    condName: expression;
<span class="o">}</span>
</code></pre>
</div>
<p>condName: the name of the condition variable.
expression: the corresponding condition expression.</p>

<p><strong>Example:</strong> creating conditions for choosing activity level.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jcond <span class="o">{</span>
    cloudonly: sys.type <span class="o">==</span> <span class="s2">"cloud"</span>;
    // <span class="nb">type </span>is a member of the sys object
    fogonly: sys.type <span class="o">==</span> <span class="s2">"fog"</span>;
    devonly: sys.type <span class="o">==</span> <span class="s2">"dev"</span>;
<span class="o">}</span>
</code></pre>
</div>
<p>This JConditional defination uses the global system context object <code class="highlighter-rouge">sys</code> . The global context object <code class="highlighter-rouge">sys</code> has several attributes that describe the runtime context. The <code class="highlighter-rouge">sys.type</code> field tells us the <code class="highlighter-rouge">type</code> of the node at which the program is currently running. And the <code class="highlighter-rouge">type</code> could be a device, fog, or cloud.</p>

<h2 id="how-to-use-condition-in-task-invocation">How to use Condition in Task Invocation?</h2>

<p>Suppose we have some JavaScript functions in a JAMScript program that we want to export. The exported function is available for execution at all levels of the hierarchy: device, fog, and cloud. When a call for that function is initiated by the C side, all levels (if the fog and cloud exist) will get the call for execution.</p>

<p>If we want to restrict the execution of the function to a particular level, we need to <strong>prepend the function definition with a condition</strong>. This way the execution only occurs where the condition evaluates to true. In the following example, the function process_at_cloud() runs only at the cloud because it is prepended by the cloudonly condition that is defined above.</p>

<p><strong>Example:</strong> restrict a function to be executed only at the cloud level.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// Definition of the <span class="k">function in </span>the J side
jasync <span class="o">{</span>cloudonly<span class="o">}</span> <span class="k">function </span>process_at_cloud<span class="o">()</span> <span class="o">{</span>
    ...
<span class="o">}</span>
// Invocation of the <span class="k">function in </span>the C side
process_at_cloud<span class="o">()</span>;
</code></pre>
</div>

<h2 id="what-values-can-be-evaluted-by-jconditional">What values can be evaluted by JConditional?</h2>

<ul>
  <li><strong>Global variables</strong> (e.g., the members of the sys object).<br />
The global context object <strong>sys</strong> provides many attributes that can be tested as a precondition before a task execution is launched at a node.</li>
</ul>

<p><strong>tags</strong> – A node could be characterized by a number of tags that are arbitrarily associated with the node. For instance, a thermostat could have a “temp_sensor” tag associated with it. Using the optional tags field, a JAMScript could specify the tags a node possess before accepting the task. Because a node could have many tags, we use the inclusion test operator to test whether a node has a specific tag. This field can optionally include an array of tags that describe a particular node. To check whether a particular tag is specified, use sys.tags := “temp_sensor” . In this case, the inclusion test operator := is used.</p>

<p><strong>loyalty</strong> – Loyality is a measure of the likelihood a node would complete the execution of the task. It differs based on the task’s duration and the time of invoking the function. The value specified in this field in the minimum value the node is expected to have before undertaking to run the task. It is a value between 0 and 1.0 and is specified as follows: sys.loyalty == 0.9.</p>

<p><strong>zone</strong> – The network of nodes over which a JAMScript program runs can be broken down into many zones. Certain applications might want to specify zone-based proximity or non-proximity as a precondition for task execution. For instance, sys.zone == 10 will ensure that the task execution only takes place on nodes that are in zone 10. A hardcoded zone number would not be very useful because the zone numbers cannot be known at programming time. Therefore, the best way of specifying this condition by using a jdata variable controlled by a broadcaster. We can converge all the execution to a particular zone or ensure that the execution is on diverse locations.</p>

<p><strong>type</strong> – JAMScript runs on three different types of nodes: device, fog, and cloud. Using this field we can specify the node type that is necessary to run a particular task.</p>

<ul>
  <li>The <strong>sync</strong> object
While the sys object specifies the context that should be satisfied by a single node before the task is launched on it, the sync object specifies the synchronization requirements that should be satisfied before a synchronous task could be launched at a node.</li>
</ul>

<p><strong>degree</strong> – Synchronous tasks perform group activities. Using synchronization degree, we can specify the minimum number of nodes that are needed to launch a synchronous task. Unlike the contextual conditions specified using sys , sync provides environmental conditions that should be met. In particular, the size of the peer group of nodes that should be present to run synchronous task.</p>

<p><strong>confirm</strong> – This is another group condition. While degree specifies the number of nodes that should be present to start the task execution, confirm specifies the fraction of nodes that should complete the task to consider the task execution to be a success.</p>

<ul>
  <li>
    <p>The <strong>exec</strong> object
The condition expressed using the exec is object is very different from the other two. This specifies an execution condition that should be met to start the task execution. In particular, the starting delay. The most useful use of this condition is to introduce a random delay to the execution of a group task execution. For instance, by specifying exec.delay := random we can introduce random delays for starting.</p>
  </li>
  <li>
    <p><strong>jdata variables</strong>, i.e, JAMDatasources, in the same program.
By default, when jdata defined parameters are used in expressions, average values are computed for each parameter before the comparison.</p>
  </li>
</ul>

<p><strong>Example:</strong> create a jconditional on a logger</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jdata<span class="o">{</span>
    float x as logger;
<span class="o">}</span>

jcond<span class="o">{</span>
    less: x&lt;22.5;
<span class="o">}</span>
</code></pre>
</div>
<p>Here, we are comparing the average (measured over a window of logged values) to 22.5 and the condition would evaluate to true if the average of the temperature values is smaller than 22.5. The average value used in the condition expression is computed over all the streams at the device, where the condition is evaluated.</p>

<p>Instead of average values other measures such as min, max can be used by specifying them in the expression as follows. The average, min, and max values are computed over a moving window of values of the time series. When multiple streams (i.e., multiple devices) the window spans all available streams.</p>

<p><strong>Example:</strong> create a jconditional to evaluate the maximum value recorded by a logger</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jdata<span class="o">{</span>
    float x as logger;
<span class="o">}</span>

jcond<span class="o">{</span>
    much_less: max<span class="o">(</span>x<span class="o">)</span>&lt;22.5;
<span class="o">}</span>
</code></pre>
</div>

<p><strong>Example:</strong> create a jconditional to evaluate the value of a structural logger</p>

<div class="highlighter-rouge"><pre class="highlight"><code>jdata<span class="o">{</span>
    struct temp_reading <span class="o">{</span>
        int tempvalue;
        int xcoord;
        int ycoord;
    <span class="o">}</span> readings as logger;
<span class="o">}</span>

jcond <span class="o">{</span>
    low_temp: avg<span class="o">(</span>readings.tempvalue<span class="o">)</span> &lt; 22.5;
<span class="o">}</span>
</code></pre>
</div>

<h2 id="can-i-use-logical-operators">Can I use logical operators?</h2>

<p>Yes sure. There are two places where we can use logical operators. They can be used either in a jcond{…} section to defined a jconditional variable, or inside an activity declaration to combine two or more jconditional variables.</p>

<p><strong>Example:</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>jdata <span class="o">{</span>
    float temp as logger<span class="o">(</span>fog<span class="o">)</span>;
<span class="o">}</span>

jcond <span class="o">{</span>
    low_dev_temp: sys.type <span class="o">==</span> <span class="s2">"dev"</span> <span class="o">&amp;&amp;</span> temp &lt; 18.5;
    dev_only: sys.type <span class="o">==</span> “dev”;
    low_temp: temp &lt; 18.5;
<span class="o">}</span>

jasync <span class="o">{</span>low_dev_temp<span class="o">}</span> <span class="k">function </span>fname<span class="o">()</span> <span class="o">{</span>
    // turns on the heater <span class="k">in </span>the room
<span class="o">}</span>

jasync <span class="o">{</span>low_temp <span class="o">&amp;&amp;</span> dev_only<span class="o">}</span> <span class="k">function </span>fname2<span class="o">()</span> <span class="o">{</span>
    // turns on the heater <span class="k">in </span>the room
<span class="o">}</span>
</code></pre>
</div>

<h1 id="section">#</h1>

	    
    </div>
  </div>
</div>


    <footer>
  <div class="container beautiful-jekyll-footer">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="https://github.com/wenger" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
      
		  
          <li>
            <a href="mailto:robert.wenger@mail.mcgill.ca" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
		  
		  
		  
      
      
      
      
		  
        </ul>
        <p class="copyright text-muted">
		  Robert Wenger
		  &nbsp;&bull;&nbsp;
		  2018

		  
	    </p>
	        <!-- Please don't remove this, keep my open source work credited :) -->
		<p class="theme-by text-muted">
		  Theme by
		  <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
		</p>
      </div>
    </div>
  </div>
</footer>

  
    






  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script>
      	if (typeof jQuery == 'undefined') {
      	  document.write('<script src="/JAMScript-beta/js/jquery-1.11.2.min.js"></scr' + 'ipt>');
      	}
      </script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/JAMScript-beta/js/bootstrap.min.js"></script>
    
  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
	<script src="/JAMScript-beta/js/main.js"></script>
    
  




  
  </body>
</html>
